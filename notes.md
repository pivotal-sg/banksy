EventSourcing (our take on ES!) ... some notes on architecture ...

- An aggregate is a representations of an entity, or group of tightly interrelated entities.
- Aggregates may publish events (not dispatch commands)
- dispatcher of a Command receives a CommandResult<T>
- Event Publishing does NOT generate an EventResult<T>
- Communication directly between Aggregates IS ILLEGAL!
- Aggregates apply events after publishing them to the Event Log

# Major components

- **AccountCommandDispatcher**
    - Resposibilities
        - dispatch commands to the AccountService
    - Collaborators
        - AccountService

- **AccountService**
    - Resposibilities
        - Keep Account Aggregates updated
        - Persist new events and apply them to the aggregate
    - Collaborators
        - AccountRepo
        - EventBus
        - EventStore

- **AccountRepository**
    - Resposibilities
        - get/save account aggregate
    - Collaborators
        - AccountAggregate

- **AccountAggregate**
    - Resposibilities
        - validates command
        - apply events

- **AccountQueryService**
    - Resposibilities
        - Forward events to relevant projections
    - Collaborators
        - EventBus

- **QueryDispatcher**
    - Resposibilities
        - route query requests to projections and receive results
    - Collaborators
        - Projections

- **EventStore**
    - Resposibilities
        - Log events
    - Collaborators
        - EventBus

- **EventBus**
    - Resposibilities
        - subscribe events
        - publish events

    - Collaborators
        - Publishers
        - Subscribers

# Spec

- [x] Create account
    - [x] Set balance to 0
    - [x] Get account number in result of command
    - [x] Indicate success

    - [x] command is executed
        - [x] uuid (account number) will be generated by the command
        - [x] AccountCreated Event is built and published
        - [x] results are returned to caller

- [x] View account / balance
    - [x] Show top level account details


- [x] Credit Account
    - [x] Validate positive credit amount
    - [x] Show success/fail
    - [x] AccountCredited Event is built and published
    - [x] Querying shows the account balance has changed

- [x] Debit Account
    - [x] Validate positive debit amount
    - [x] Show success/fail
    - [x] AccountDebited Event is built and published

- [ ] Overdraft facility
    - [ ] Fix aggregate application
    - [ ] ~~Validate debits are within overdraft limit~~
    - [ ] ~~Charge monthly interest on Overdraft (at EOM)~~

### Deferred implementation...

- [ ] Add JSON RPC controller
- [ ] ~~Transfer from Account A to Account B~~
- [ ] ~~Pay annual interest on credit~~

# Tools

- [Kotlin](https://kotlinlang.org)
- [KSpec](https://github.com/dam5s/kspec) RSpec style testing for Kotlin
